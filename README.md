
# Общие данные

Смарт-контракт позволяет воспользоваться модулем Flash Mint от MakerDao, выпустить определенное количество DAI и ребелансировать G-UNI CDP Vault, открывая или погашая позиция в Vault и получить за это профит.

# Рассмотрим общую концепцию

## Открытие позиции (wind)

Пример транзакции:
https://etherscan.io/tx/0x6b8060119e6c8266d5f158d5c721df730995fb1183362a4dda451b4f166a7da8

https://dashboard.tenderly.co/tx/mainnet/0x6b8060119e6c8266d5f158d5c721df730995fb1183362a4dda451b4f166a7da8

Через Flash Mint модуль, берется заем в DAI. Взять заем в Flash Mint может любой пользователь с одним условием. Погасить DAI  нужно в той же транзакции, в которой происходит заем. Иными словами Flash Mint это аналог Flash Loans.
Получив определенную сумму в DAI. Через Curve 3-pool происходит, обмен части DAI на USDC, в соответствии с параметрами полученными из G-UNI Pool.

Выше указанный код работает с G-UNI LP Tokens. Данный токен это токен пула Gelato Uniswap V3 Pool, который предоставляет ликвидность на Uniswap V3 в паре, и затем постоянно производит реинвестирование комиссий в пул.
Имея теперь DAI и USDC, контракт предоставляет ликвидность на G-UNI и получает токены G-UNI.
Затем, происходит блокировка G-UNI на MCD Vault и выпускаются дополнительные DAI.
Сумма необходимую для погашения возвращаем в пул. Профит, если он есть переводим пользователю. Здесь обращаю внимание, профита может и не быть. В этом случае, необходимая сумма для погашения списывается с адреса пользователя, который создает позицию.

## Закрытие позиции (unwind)
Пример:
https://etherscan.io/tx/0xd51826068588acdcd49db4d617ffe59b4552b4f1a9caa157cc1d343bd2ba0589

https://dashboard.tenderly.co/tx/mainnet/0xd51826068588acdcd49db4d617ffe59b4552b4f1a9caa157cc1d343bd2ba0589

Через Flash Mint модуль, берем заем в DAI.
Получив сумму в DAI, погашаем задолженность в MCD Vault пользователя и разблокируем G-UNI.
Затем происходит погашение G-UNI и контракт получаем DAI и USDC, с учетом накопленного профита.
USDC обменивается на DAI.
Сумма необходимую для погашения возвращаем в пул. Профит, если он есть переводим пользователю. Здесь обращаю внимание, профита может и не быть. В этом случае, необходимая сумма для погашения списывается с адреса пользователя, который закрывает позицию.

# Детальный разбор
Присутствуем в коде контракта Leverage.sol

# Перед использованием
Чтобы использовать контракт необходимо сначала


1. vat.hope(адрес контракта), разрешить адресу контракта модифицировать Vault
2. dai.approve(адрес контракта, AMOUNT)
3. leverage.wind(AMOUNT, MIN_AMOUNT_EXPECTED_IN_WALLET_AFTER_TX)
4. vat.nope(адрес контракта)		// c целью безопасности по окончании транзакции запретить

MIN_AMOUNT_EXPECTED_IN_WALLET_AFTER_TX можно расчитать с помощью функции getWindEstimates().

